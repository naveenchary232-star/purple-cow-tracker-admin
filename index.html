<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Purple Cow Laundry Tracker - Complete</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        @keyframes bounce {
            0%, 100% { transform: translateY(-25%); }
            50% { transform: translateY(0); }
        }
        .animate-bounce { animation: bounce 1s infinite; }
        @media print {
            body { visibility: hidden; }
            .printable-runsheet, .printable-runsheet * { visibility: visible; }
            .printable-runsheet { position: absolute; left: 0; top: 0; width: 100%; }
        }
    </style>
</head>
<body class="bg-gray-900">
    <div id="root"></div>

    <script>
        // FIREBASE CONFIGURATION
        const firebaseConfig = {
            apiKey: "AIzaSyCorv41Qlud5cK4dvABePg6boVAr8vEJU",
            authDomain: "purple-cow-admin-2232f.firebaseapp.com",
            databaseURL: "https://purple-cow-admin-2232f-default-rtdb.firebaseio.com",
            projectId: "purple-cow-admin-2232f",
            storageBucket: "purple-cow-admin-2232f.firebasestorage.app",
            messagingSenderId: "295566586816",
            appId: "1295566586816web358452d3998f2d78370e25",
            measurementId: "G-TE32V3BTHE"
        };

        // Initialize Firebase
        let db;
        let firebaseInitialized = false;
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            firebaseInitialized = true;
            console.log("Firebase initialized successfully");
        } catch (error) {
            console.error("Firebase initialization error:", error);
        }

        // COMPLETE LAUNDRY TRACKER APPLICATION
        const App = {
            customers: [],
            riders: [],
            runsheets: [],
            showAddCustomer: false,
            showAddRider: false,
            showCreateRunsheet: false,
            showRunsheetDashboard: true,
            selectedRunsheetId: null,
            searchTerm: '',
            loading: true,
            copiedCode: null,
            saving: false,
            printRunsheetId: null,
            newCustomer: { name: '', phone: '', address: '', plan: '2699', startDate: new Date().toISOString().split('T')[0] },
            newRider: { name: '', phone: '', vehicle: '' },
            runsheet: { riderId: '', type: 'pickup', date: new Date().toISOString().split('T')[0], selectedOrders: [] },

            async init() {
                console.log("Initializing complete app...");
                if (!firebaseInitialized) {
                    this.loading = false;
                    this.render();
                    alert("Firebase initialization failed. Please check your internet connection and refresh.");
                    return;
                }
                await Promise.all([this.loadCustomers(), this.loadRiders(), this.loadRunsheets()]);
                this.loading = false;
                this.render();
            },

            async loadCustomers() {
                try {
                    const snapshot = await db.collection('customers').orderBy('startDate', 'desc').get();
                    this.customers = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    console.log(`Loaded ${this.customers.length} customers`);
                } catch (error) {
                    console.error("Error loading customers:", error);
                }
            },

            async loadRiders() {
                try {
                    const snapshot = await db.collection('riders').orderBy('name').get();
                    this.riders = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    console.log(`Loaded ${this.riders.length} riders`);
                } catch (error) {
                    console.error("Error loading riders:", error);
                }
            },

            async loadRunsheets() {
                try {
                    const snapshot = await db.collection('runsheets').orderBy('createdAt', 'desc').get();
                    this.runsheets = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                } catch (error) {
                    console.error("Error loading runsheets:", error);
                }
            },

            async addCustomer() {
                if (!this.newCustomer.name || !this.newCustomer.phone) {
                    alert("Please enter name and phone number");
                    return;
                }
                this.saving = true;
                this.render();

                const customer = {
                    name: this.newCustomer.name.trim(),
                    phone: this.newCustomer.phone.trim(),
                    address: this.newCustomer.address.trim(),
                    plan: this.newCustomer.plan,
                    startDate: this.newCustomer.startDate,
                    washes: Array(10).fill(null).map((_, i) => ({
                        washNumber: i + 1,
                        status: 'pending',
                        pickupDate: null,
                        deliveryDate: null,
                        pickupCode: null,
                        deliveryCode: null,
                        ofdComment: ''
                    })),
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                try {
                    const docRef = await db.collection('customers').add(customer);
                    this.customers.unshift({ id: docRef.id, ...customer });
                    this.newCustomer = { name: '', phone: '', address: '', plan: '2699', startDate: new Date().toISOString().split('T')[0] };
                    this.showAddCustomer = false;
                    this.saving = false;
                    this.render();
                    alert("Customer added successfully!");
                } catch (error) {
                    this.saving = false;
                    this.render();
                    alert("Failed to add customer: " + error.message);
                }
            },

            async addRider() {
                if (!this.newRider.name || !this.newRider.phone || !this.newRider.vehicle) {
                    alert("Please fill all rider details");
                    return;
                }
                try {
                    const docRef = await db.collection('riders').add(this.newRider);
                    this.riders.push({ id: docRef.id, ...this.newRider });
                    this.newRider = { name: '', phone: '', vehicle: '' };
                    this.showAddRider = false;
                    this.render();
                    alert("Rider added successfully!");
                } catch (error) {
                    alert("Failed to add rider: " + error.message);
                }
            },

            toggleRunsheetMode() {
                this.showCreateRunsheet = !this.showCreateRunsheet;
                this.runsheet.selectedOrders = [];
                this.render();
            },

            selectOrder(customerId, washNumber) {
                if (!this.showCreateRunsheet) return;
                const exists = this.runsheet.selectedOrders.find(o => o.customerId === customerId && o.washNumber === washNumber);
                if (exists) {
                    this.runsheet.selectedOrders = this.runsheet.selectedOrders.filter(o => !(o.customerId === customerId && o.washNumber === washNumber));
                } else {
                    this.runsheet.selectedOrders.push({ customerId, washNumber });
                }
                this.render();
            },

            async createRunsheet() {
                if (!this.runsheet.riderId || this.runsheet.selectedOrders.length === 0) {
                    alert("Please select rider and at least one order");
                    return;
                }
                const rider = this.riders.find(r => r.id === this.runsheet.riderId);
                const runsheetData = {
                    rider,
                    type: this.runsheet.type,
                    date: this.runsheet.date,
                    orders: this.runsheet.selectedOrders,
                    runsheetId: `RS${Date.now().toString().slice(-6)}`,
                    closed: false,
                    closedAt: null,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                try {
                    const docRef = await db.collection('runsheets').add(runsheetData);
                    await this.updateOrdersToOFD(this.runsheet.selectedOrders);
                    this.showCreateRunsheet = false;
                    this.printRunsheetId = docRef.id;
                    this.runsheet = { riderId: '', type: 'pickup', date: new Date().toISOString().split('T')[0], selectedOrders: [] };
                    this.render();
                    setTimeout(() => window.print(), 500);
                    alert(`Runsheet created! ID: ${runsheetData.runsheetId}`);
                } catch (error) {
                    alert("Failed to create runsheet: " + error.message);
                }
            },

            async updateOrdersToOFD(orders) {
                for (const [customerId, washNumber] of orders) {
                    const customer = this.customers.find(c => c.id === customerId);
                    if (!customer) continue;
                    const washIndex = customer.washes.findIndex(w => w.washNumber === washNumber);
                    if (washIndex === -1) continue;
                    customer.washes[washIndex].status = 'ofd';
                    await db.collection('customers').doc(customerId).update({ washes: customer.washes });
                    const customerIndex = this.customers.findIndex(c => c.id === customerId);
                    if (customerIndex !== -1) {
                        this.customers[customerIndex] = customer;
                    }
                    this.render();
                }
            },

            async updateWashStatus(customerId, washNumber, status, dateType = null, ofdComment = null) {
                const customerIndex = this.customers.findIndex(c => c.id === customerId);
                if (customerIndex === -1) return;
                const customer = this.customers[customerIndex];
                const washIndex = customer.washes.findIndex(w => w.washNumber === washNumber);
                if (washIndex === -1) return;
                const wash = { ...customer.washes[washIndex], status };

                if (dateType === 'pickup') {
                    status = 'picked-up';
                    wash.pickupDate = new Date().toISOString().split('T')[0];
                    wash.pickupCode = this.generateCode();
                    const completedCount = customer.washes.filter(w => w.status === 'delivered').length;
                    setTimeout(() => this.sendWhatsAppNotification(customer.phone, customer.name, washNumber, 'pickup', wash.pickupCode, completedCount), 100);
                } else if (dateType === 'delivery') {
                    status = 'delivered';
                    wash.deliveryDate = new Date().toISOString().split('T')[0];
                    wash.deliveryCode = this.generateCode();
                    const completedCount = customer.washes.filter(w => w.status === 'delivered').length + 1;
                    setTimeout(() => this.sendWhatsAppNotification(customer.phone, customer.name, washNumber, 'delivery', wash.deliveryCode, completedCount), 100);
                }

                if (ofdComment !== null) {
                    wash.ofdComment = ofdComment;
                }

                customer.washes[washIndex] = wash;
                this.customers[customerIndex] = customer;

                try {
                    await db.collection('customers').doc(customerId).update({ washes: customer.washes });
                    await this.checkAndCloseRunsheet(customerId, washNumber);
                    this.render();
                } catch (error) {
                    console.error("Error updating wash status:", error);
                }
            },

            async checkAndCloseRunsheet(customerId, washNumber) {
                // Find all runsheets containing this order
                const relevantRunsheets = this.runsheets.filter(runsheet => 
                    runsheet.orders.some(order => order.customerId === customerId && order.washNumber === washNumber)
                );

                for (const runsheet of relevantRunsheets) {
                    if (runsheet.closed) continue;
                    
                    let allDelivered = true;
                    for (const order of runsheet.orders) {
                        const customer = this.customers.find(c => c.id === order.customerId);
                        if (!customer) {
                            allDelivered = false;
                            break;
                        }
                        const wash = customer.washes.find(w => w.washNumber === order.washNumber);
                        if (!wash || wash.status !== 'delivered') {
                            allDelivered = false;
                            break;
                        }
                    }

                    if (allDelivered) {
                        await db.collection('runsheets').doc(runsheet.id).update({
                            closed: true,
                            closedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        // Update local state
                        const runsheetIndex = this.runsheets.findIndex(r => r.id === runsheet.id);
                        if (runsheetIndex !== -1) {
                            this.runsheets[runsheetIndex] = { ...runsheet, closed: true, closedAt: new Date().toISOString() };
                        }
                    }
                }
            },

            generateCode() {
                return Math.floor(1000 + Math.random() * 9000).toString();
            },

            sendWhatsAppNotification(phone, customerName, washNumber, type, code, completedWashes) {
                navigator.clipboard.writeText(code).then(() => {
                    this.copiedCode = code;
                    this.render();
                    setTimeout(() => {
                        this.copiedCode = null;
                        this.render();
                    }, 2000);
                });

                let cleanPhone = phone.replace(/[^0-9]/g, '');
                if (!cleanPhone.startsWith('91') && cleanPhone.length === 10) {
                    cleanPhone = '91' + cleanPhone;
                }
                const currentDate = new Date().toLocaleDateString('en-IN', { day: '2-digit', month: '2-digit', year: 'numeric' });
                let message;
                if (type === 'pickup') {
                    message = `PURPLE COW LAUNDRY\nHello ${customerName}!\nPICKUP CONFIRMED!\nOrder ID: ${code}\nWash Number: ${washNumber}/10\nProgress: ${completedWashes}/10\nCompleted: ${currentDate}\n\nYour clothes are now in our care!\nPremium wash & dry service\nWe'll notify you for delivery\nTrack your order with ID: ${code}\n\nThank you for choosing Purple Cow!`;
                } else if (type === 'delivery') {
                    const remainingWashes = 10 - completedWashes;
                    const completionBonus = completedWashes === 10 ? "ðŸŽ‰ CONGRATULATIONS! All 10 washes completed! ðŸŽ‰" : `Remaining: ${remainingWashes} more to go!`;
                    message = `PURPLE COW LAUNDRY\nHello ${customerName}!\nDELIVERY COMPLETED! âœ…\nOrder ID: ${code}\nWash Number: ${washNumber}/10\nProgress: ${completedWashes}/10\nCompleted: ${currentDate}\n\nYour fresh, clean laundry is delivered!\nWashed, dried & neatly folded ðŸ˜Š\n\nHope you love our service\n${completionBonus}\n\nThank you for trusting Purple Cow!\nCall us anytime for next pickup!`;
                }
                const whatsappUrl = `https://wa.me/${cleanPhone}?text=${encodeURIComponent(message)}`;
                window.open(whatsappUrl, '_blank');
            },

            getStatusColor(status) {
                switch (status) {
                    case 'pending': return 'bg-gray-200 text-gray-700';
                    case 'picked-up': return 'bg-blue-500 text-white';
                    case 'ofd': return 'bg-orange-500 text-white';
                    case 'delivered': return 'bg-green-500 text-white';
                    default: return 'bg-gray-200 text-gray-700';
                }
            },

            getCompletedWashes(customer) {
                return customer.washes.filter(w => w.status === 'delivered').length;
            },

            getFilteredCustomers() {
                return this.customers.filter(customer =>
                    customer.name.toLowerCase().includes(this.searchTerm.toLowerCase()) ||
                    customer.phone.includes(this.searchTerm)
                );
            },

            copyCode(code) {
                navigator.clipboard.writeText(code).then(() => {
                    this.copiedCode = code;
                    this.render();
                    setTimeout(() => {
                        this.copiedCode = null;
                        this.render();
                    }, 2000);
                });
            },

            getRunsheetStatus(runsheet) {
                if (runsheet.closed) return 'Closed';
                let deliveredCount = 0;
                for (const order of runsheet.orders) {
                    const customer = this.customers.find(c => c.id === order.customerId);
                    if (customer) {
                        const wash = customer.washes.find(w => w.washNumber === order.washNumber);
                        if (wash && wash.status === 'delivered') deliveredCount++;
                    }
                }
                return `${deliveredCount}/${runsheet.orders.length} Delivered`;
            },

            render() {
                const root = document.getElementById('root');
                const filteredCustomers = this.getFilteredCustomers();
                
                root.innerHTML = `
                    <div class="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 p-4">
                        ${this.copiedCode ? `
                            <div class="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-2 z-50 animate-bounce">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                </svg>
                                <span class="font-semibold">Order ID ${this.copiedCode} Copied!</span>
                            </div>
                        ` : ''}
                        
                        ${this.loading ? `
                            <div class="min-h-screen flex items-center justify-center">
                                <div class="text-center">
                                    <div class="animate-spin rounded-full h-16 w-16 border-b-4 border-purple-500 mx-auto mb-4"></div>
                                    <p class="text-gray-300 text-lg">Loading your data...</p>
                                </div>
                            </div>
                        ` : `
                            <div class="max-w-7xl mx-auto">
                                <!-- Header -->
                                <div class="bg-gray-800 rounded-lg shadow-2xl p-6 mb-6 border border-purple-500/30">
                                    <div class="flex flex-wrap items-center justify-between gap-4 mb-4">
                                        <div>
                                            <h1 class="text-3xl font-bold text-purple-400 flex items-center gap-2">
                                                Purple Cow Laundry Tracker
                                            </h1>
                                            <p class="text-gray-300 mt-1">Complete workflow: Riders â†’ Runsheets â†’ OFD â†’ Delivery</p>
                                        </div>
                                    </div>
                                    <div class="flex flex-wrap gap-3">
                                        <button onclick="App.showAddRider = !App.showAddRider; App.render();" 
                                                class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition shadow-lg">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                            </svg>
                                            Add Rider
                                        </button>
                                        <button onclick="App.toggleRunsheetMode()" 
                                                class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition shadow-lg ${this.showCreateRunsheet ? 'ring-2 ring-yellow-400' : ''}">
                                            ${this.showCreateRunsheet ? 'Cancel' : 'Create'} Runsheet
                                        </button>
                                        <button onclick="App.showRunsheetDashboard = !App.showRunsheetDashboard; App.render();" 
                                                class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition shadow-lg ${this.showRunsheetDashboard ? 'ring-2 ring-green-400' : ''}">
                                            ${this.showRunsheetDashboard ? 'Hide' : 'Show'} Runsheet Dashboard
                                        </button>
                                        <button onclick="App.showAddCustomer = !App.showAddCustomer; App.render();" 
                                                class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition shadow-lg">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                                            </svg>
                                            Add Customer
                                        </button>
                                    </div>
                                    <div class="flex items-center gap-4 text-sm text-gray-300 mt-4">
                                        <span>Riders: ${this.riders.length}</span>
                                        <span>Customers: ${this.customers.length}</span>
                                        <span>Runsheets: ${this.runsheets.filter(r => !r.closed).length} Active / ${this.runsheets.filter(r => r.closed).length} Closed</span>
                                    </div>
                                </div>

                                <div class="relative mt-4">
                                    <svg class="absolute left-3 top-3 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                    </svg>
                                    <input type="text" placeholder="Search by name or phone..." 
                                           value="${this.searchTerm}" 
                                           oninput="App.searchTerm = this.value; App.render()"
                                           class="w-full pl-10 pr-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400">
                                </div>

                                <!-- Add Rider Form -->
                                ${this.showAddRider ? `
                                    <div class="bg-gray-800 rounded-lg shadow-2xl p-6 mb-6 border border-indigo-500/30">
                                        <h2 class="text-xl font-bold text-indigo-400 mb-4">Add New Rider</h2>
                                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-300 mb-2">Rider Name</label>
                                                <input type="text" value="${this.newRider.name}" oninput="App.newRider.name = this.value" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 text-white">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-300 mb-2">Phone</label>
                                                <input type="tel" value="${this.newRider.phone}" oninput="App.newRider.phone = this.value" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 text-white">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-300 mb-2">Vehicle No.</label>
                                                <input type="text" value="${this.newRider.vehicle}" oninput="App.newRider.vehicle = this.value" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 text-white">
                                            </div>
                                        </div>
                                        <div class="flex gap-3 mt-4">
                                            <button onclick="App.addRider()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg transition shadow-lg">Save Rider</button>
                                            <button onclick="App.showAddRider = false; App.render();" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg transition">Cancel</button>
                                        </div>
                                    </div>
                                ` : ''}

                                <!-- Create Runsheet Form -->
                                ${this.showCreateRunsheet ? `
                                    <div class="bg-gray-800 rounded-lg shadow-2xl p-6 mb-6 border border-yellow-500/30">
                                        <h2 class="text-xl font-bold text-yellow-400 mb-4">Create New Runsheet</h2>
                                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-300 mb-2">Rider</label>
                                                <select value="${this.runsheet.riderId}" onchange="App.runsheet.riderId = this.value; App.render()" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 text-white">
                                                    <option value="">Select Rider</option>
                                                    ${this.riders.map(rider => `<option value="${rider.id}">${rider.name} - ${rider.vehicle}</option>`).join('')}
                                                </select>
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-300 mb-2">Type</label>
                                                <select value="${this.runsheet.type}" onchange="App.runsheet.type = this.value; App.render()" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 text-white">
                                                    <option value="pickup">Pickup</option>
                                                    <option value="delivery">Delivery</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-300 mb-2">Date</label>
                                                <input type="date" value="${this.runsheet.date}" onchange="App.runsheet.date = this.value" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 text-white">
                                            </div>
                                            <div class="flex items-end">
                                                <div class="bg-yellow-600 text-white px-6 py-3 rounded-lg font-bold shadow-lg">
                                                    ${this.runsheet.selectedOrders.length} Orders
                                                </div>
                                            </div>
                                        </div>
                                        <div class="flex gap-3">
                                            <button onclick="App.createRunsheet()" class="bg-yellow-600 hover:bg-yellow-700 text-white px-8 py-3 rounded-lg font-bold shadow-lg">Create & Print Runsheet</button>
                                            <button onclick="App.toggleRunsheetMode()" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg">Cancel</button>
                                        </div>
                                    </div>
                                ` : ''}

                                <!-- Add Customer Form -->
                                ${this.showAddCustomer ? `
                                    <div class="bg-gray-800 rounded-lg shadow-2xl p-6 mb-6 border border-purple-500/30">
                                        <h2 class="text-xl font-bold text-purple-400 mb-4">Add New Customer</h2>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-300 mb-2">Customer Name</label>
                                                <input type="text" value="${this.newCustomer.name}" oninput="App.newCustomer.name = this.value" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 text-white">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-300 mb-2">Phone Number</label>
                                                <input type="tel" value="${this.newCustomer.phone}" oninput="App.newCustomer.phone = this.value" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 text-white">
                                            </div>
                                            <div class="md:col-span-2">
                                                <label class="block text-sm font-medium text-gray-300 mb-2">Address</label>
                                                <input type="text" value="${this.newCustomer.address}" oninput="App.newCustomer.address = this.value" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 text-white">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-300 mb-2">Start Date</label>
                                                <input type="date" value="${this.newCustomer.startDate}" onchange="App.newCustomer.startDate = this.value" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 text-white">
                                            </div>
                                            <div>
                                                <label class="block
